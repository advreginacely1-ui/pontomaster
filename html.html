<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PontoMaster - Sistema Completo de Ponto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Biblioteca PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.0/dist/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        /* TELAS DE AUTENTICA√á√ÉO */
        .auth-container {
            display: flex;
            min-height: 80vh;
        }
        
        .auth-sidebar {
            flex: 1;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .auth-sidebar .logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .auth-sidebar h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .auth-sidebar p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .auth-content {
            flex: 2;
            padding: 50px;
            background: rgba(30, 41, 59, 0.9);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--light);
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-select {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
        }
        
        .form-select option {
            background: var(--dark);
            color: white;
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .form-checkbox input {
            width: 20px;
            height: 20px;
        }
        
        .btn {
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* SISTEMA PRINCIPAL */
        .main-system {
            display: none;
        }
        
        .navbar {
            background: rgba(30, 41, 59, 0.9);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-section i {
            font-size: 2.5rem;
            color: var(--primary);
        }
        
        .logo-section h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(37, 99, 235, 0.2);
            border-radius: 50px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
        }
        
        .cloud-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 50px;
            color: var(--success);
            font-weight: 500;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .card-title {
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        /* CONTROLE DE PONTO */
        .ponto-container {
            text-align: center;
            padding: 20px 0;
        }
        
        .timer {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(37, 99, 235, 0.5);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 20px;
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        .status-badge.active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .status-badge.paused {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        
        @media (max-width: 600px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* INFO DO FUNCION√ÅRIO */
        .employee-info {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .employee-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
        }
        
        .employee-details div {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }
        
        .employee-details span:first-child {
            color: var(--gray);
        }
        
        .employee-details span:last-child {
            font-weight: 500;
        }
        
        /* HIST√ìRICO */
        .history-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* GERADOR DE PDF */
        .pdf-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .pdf-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .pdf-card:hover {
            background: rgba(37, 99, 235, 0.2);
            transform: scale(1.05);
            border-color: var(--primary);
        }
        
        .pdf-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        /* PAINEL ADMINISTRATIVO (EMPRESA) */
        .admin-panel {
            display: none;
        }
        
        .admin-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .admin-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* MODAIS */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--dark);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--primary);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }
        
        /* NOTIFICA√á√ïES */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification-success {
            background: linear-gradient(135deg, var(--success), #059669);
        }
        
        .notification-error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }
        
        .notification-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }
        
        /* FOOTER */
        .footer {
            text-align: center;
            padding: 25px;
            color: var(--gray);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }
        
        /* LOADING */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- CONTAINER DE AUTENTICA√á√ÉO -->
    <div class="auth-container" id="authContainer">
        <!-- Sidebar -->
        <div class="auth-sidebar">
            <div class="logo">
                <i class="fas fa-building-user"></i>
            </div>
            <h1>PontoMaster</h1>
            <p>Sistema completo de controle de ponto</p>
            <div style="margin-top: 40px; text-align: left; width: 100%; max-width: 300px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <i class="fas fa-cloud-upload-alt" style="color: var(--success);"></i>
                    <span>Armazenamento em nuvem</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <i class="fas fa-file-pdf" style="color: var(--danger);"></i>
                    <span>Relat√≥rios em PDF</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <i class="fas fa-id-card" style="color: var(--primary);"></i>
                    <span>CNPJ + CPF/PIS</span>
                </div>
            </div>
        </div>
        
        <!-- Conte√∫do -->
        <div class="auth-content">
            <!-- Abas -->
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthTab('empresa')">üè¢ Empresa</button>
                <button class="auth-tab" onclick="showAuthTab('funcionario')">üë§ Funcion√°rio</button>
                <button class="auth-tab" onclick="showAuthTab('login')">üîê Login</button>
            </div>
            
            <!-- Cadastro Empresa -->
            <form id="empresaForm" class="auth-form active">
                <h2 style="color: var(--primary); margin-bottom: 30px;">Cadastro de Empresa</h2>
                
                <div class="form-group">
                    <label class="form-label">Raz√£o Social *</label>
                    <input type="text" id="empresaRazaoSocial" class="form-input" placeholder="Nome completo da empresa" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome Fantasia</label>
                    <input type="text" id="empresaNomeFantasia" class="form-input" placeholder="Nome comercial">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CNPJ *</label>
                        <input type="text" id="empresaCNPJ" class="form-input" placeholder="00.000.000/0001-00" required
                               oninput="formatCNPJ(this)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Inscri√ß√£o Estadual</label>
                        <input type="text" id="empresaIE" class="form-input" placeholder="000.000.000.000">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">E-mail Corporativo *</label>
                    <input type="email" id="empresaEmail" class="form-input" placeholder="contato@empresa.com" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Senha *</label>
                        <input type="password" id="empresaSenha" class="form-input" placeholder="M√≠nimo 6 caracteres" minlength="6" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirmar Senha *</label>
                        <input type="password" id="empresaConfirmarSenha" class="form-input" placeholder="Digite novamente" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="tel" id="empresaTelefone" class="form-input" placeholder="(11) 99999-9999" oninput="formatPhone(this)">
                </div>
                
                <div class="form-checkbox">
                    <input type="checkbox" id="empresaTermos" required>
                    <label for="empresaTermos">Concordo com os termos de uso e pol√≠tica de privacidade</label>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="cadastrarEmpresa()">
                    <i class="fas fa-building"></i>
                    <span>Cadastrar Empresa</span>
                </button>
            </form>
            
            <!-- Cadastro Funcion√°rio -->
            <form id="funcionarioForm" class="auth-form">
                <h2 style="color: var(--primary); margin-bottom: 30px;">Cadastro de Funcion√°rio</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" id="funcionarioNome" class="form-input" placeholder="Seu nome completo" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento *</label>
                        <input type="date" id="funcionarioNascimento" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CPF *</label>
                        <input type="text" id="funcionarioCPF" class="form-input" placeholder="000.000.000-00" required
                               oninput="formatCPF(this)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">PIS/PASEP</label>
                        <input type="text" id="funcionarioPIS" class="form-input" placeholder="000.00000.00-0"
                               oninput="formatPIS(this)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">C√≥digo da Empresa *</label>
                    <input type="text" id="funcionarioCodigoEmpresa" class="form-input" placeholder="C√≥digo fornecido pela empresa" required>
                    <div style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">
                        Solicite este c√≥digo ao seu empregador
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">E-mail *</label>
                    <input type="email" id="funcionarioEmail" class="form-input" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Senha *</label>
                        <input type="password" id="funcionarioSenha" class="form-input" placeholder="M√≠nimo 6 caracteres" minlength="6" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirmar Senha *</label>
                        <input type="password" id="funcionarioConfirmarSenha" class="form-input" placeholder="Digite novamente" required>
                    </div>
                </div>
                
                <div class="form-checkbox">
                    <input type="checkbox" id="funcionarioTermos" required>
                    <label for="funcionarioTermos">Concordo com os termos de uso</label>
                </div>
                
                <button type="button" class="btn btn-success" onclick="cadastrarFuncionario()">
                    <i class="fas fa-user-plus"></i>
                    <span>Cadastrar Funcion√°rio</span>
                </button>
            </form>
            
            <!-- Login -->
            <form id="loginForm" class="auth-form">
                <h2 style="color: var(--primary); margin-bottom: 30px;">Login no Sistema</h2>
                
                <div class="form-group">
                    <label class="form-label">Tipo de Conta</label>
                    <select id="loginTipo" class="form-select" onchange="updateLoginPlaceholder()">
                        <option value="empresa">Empresa</option>
                        <option value="funcionario">Funcion√°rio</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" id="loginLabel">E-mail ou CNPJ</label>
                    <input type="text" id="loginIdentificacao" class="form-input" placeholder="E-mail ou CNPJ" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" id="loginSenha" class="form-input" placeholder="Sua senha" required>
                </div>
                
                <div class="form-checkbox">
                    <input type="checkbox" id="loginLembrar">
                    <label for="loginLembrar">Lembrar-me</label>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="fazerLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Entrar no Sistema</span>
                </button>
                
                <div style="text-align: center; margin-top: 20px; color: var(--gray);">
                    <p>Esqueceu sua senha? <a href="#" style="color: var(--primary);" onclick="esqueciSenha()">Clique aqui</a></p>
                </div>
            </form>
        </div>
    </div>
    
    <!-- SISTEMA PRINCIPAL (FUNCION√ÅRIO) -->
    <div class="main-system" id="funcionarioSystem">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo-section">
                <i class="fas fa-user-clock"></i>
                <div>
                    <h1>PontoMaster</h1>
                    <p style="font-size: 0.9rem; color: var(--gray);">Controle de Ponto - Funcion√°rio</p>
                </div>
            </div>
            
            <div class="user-info">
                <div class="cloud-status" id="cloudStatus">
                    <i class="fas fa-cloud"></i>
                    <span id="syncStatus">Sincronizado</span>
                </div>
                
                <div class="user-badge">
                    <div class="user-avatar" id="userAvatar">F</div>
                    <div>
                        <div id="userName">Funcion√°rio</div>
                        <div style="font-size: 0.8rem; color: var(--gray);" id="userMatricula">Matr√≠cula: --</div>
                    </div>
                </div>
                
                <button class="btn" style="padding: 10px 20px; background: rgba(239, 68, 68, 0.2); color: var(--danger);" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>
        
        <!-- Conte√∫do Principal -->
        <div class="main-content">
            <!-- Coluna Esquerda -->
            <div class="left-column">
                <!-- Controle de Ponto -->
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-clock"></i> Controle de Ponto
                    </h2>
                    
                    <div class="ponto-container">
                        <div class="status-badge" id="statusBadge">
                            <i class="fas fa-power-off"></i> Fora do expediente
                        </div>
                        
                        <div class="timer" id="workTimer">00:00:00</div>
                        
                        <div style="color: var(--gray); margin-bottom: 20px;">
                            Horas hoje: <span id="hoursToday" style="font-weight: bold; color: var(--primary);">0:00</span>
                            ‚Ä¢ <span id="lastSyncTime" style="font-size: 0.9rem;">Sincronizando...</span>
                        </div>
                        
                        <div class="controls-grid">
                            <button class="btn btn-success" id="startBtn" onclick="startWork()">
                                <i class="fas fa-play-circle"></i>
                                <span>Iniciar Jornada</span>
                            </button>
                            
                            <button class="btn btn-warning" id="pauseBtn" onclick="pauseWork()" disabled>
                                <i class="fas fa-pause-circle"></i>
                                <span>Pausa</span>
                            </button>
                            
                            <button class="btn btn-danger" id="endBtn" onclick="endWork()" disabled>
                                <i class="fas fa-stop-circle"></i>
                                <span>Encerrar</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Informa√ß√µes do Funcion√°rio -->
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-id-card"></i> Meus Dados
                    </h2>
                    
                    <div class="employee-info">
                        <div class="employee-photo" id="employeePhoto">
                            F
                        </div>
                        
                        <div class="employee-details" id="employeeDetails">
                            <!-- Dados ser√£o carregados aqui -->
                        </div>
                    </div>
                    
                    <button class="btn" style="width: 100%; background: rgba(255,255,255,0.1); margin-top: 15px;" onclick="visualizarMeusDados()">
                        <i class="fas fa-eye"></i>
                        <span>Visualizar Dados Completos</span>
                    </button>
                </div>
            </div>
            
            <!-- Coluna Direita -->
            <div class="right-column">
                <!-- Hist√≥rico de Hoje -->
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-history"></i> Hist√≥rico de Hoje
                        <button class="btn" style="margin-left: auto; padding: 8px 15px; background: rgba(255,255,255,0.1);" onclick="syncNow()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </h2>
                    
                    <div class="history-container" id="historyContainer">
                        <!-- Hist√≥rico ser√° carregado aqui -->
                    </div>
                </div>
                
                <!-- Gerar Relat√≥rios PDF -->
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-file-pdf"></i> Meus Relat√≥rios
                    </h2>
                    
                    <div class="pdf-options">
                        <div class="pdf-card" onclick="gerarPDFDiario()">
                            <i class="fas fa-calendar-day"></i>
                            <div>Di√°rio</div>
                        </div>
                        
                        <div class="pdf-card" onclick="gerarPDFSemanal()">
                            <i class="fas fa-calendar-week"></i>
                            <div>Semanal</div>
                        </div>
                        
                        <div class="pdf-card" onclick="gerarPDFMensal()">
                            <i class="fas fa-calendar-alt"></i>
                            <div>Mensal</div>
                        </div>
                        
                        <div class="pdf-card" onclick="gerarPDFCompleto()">
                            <i class="fas fa-file-contract"></i>
                            <div>Completo</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button class="btn" style="flex: 1; background: rgba(37, 99, 235, 0.2); color: white;" onclick="visualizarPDF()">
                            <i class="fas fa-eye"></i>
                            <span>Visualizar</span>
                        </button>
                        
                        <button class="btn" style="flex: 1; background: rgba(16, 185, 129, 0.2); color: white;" onclick="baixarPDF()">
                            <i class="fas fa-download"></i>
                            <span>Baixar PDF</span>
                        </button>
                        
                        <button class="btn" style="flex: 1; background: rgba(245, 158, 11, 0.2); color: white;" onclick="imprimirPDF()">
                            <i class="fas fa-print"></i>
                            <span>Imprimir</span>
                        </button>
                    </div>
                </div>
                
                <!-- Estat√≠sticas -->
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-chart-bar"></i> Estat√≠sticas do M√™s
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Horas Trabalhadas</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary);" id="statsHours">0h</div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Dias Trabalhados</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success);" id="statsDays">0</div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="color: var(--gray); font-size: 0.9rem;">M√©dia Di√°ria</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--warning);" id="statsAvg">0h</div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Efici√™ncia</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--danger);" id="statsEfficiency">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>PontoMaster &copy; 2024 - Sistema de controle de ponto para funcion√°rios</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">
                <i class="fas fa-shield-alt"></i> Dados protegidos por LGPD ‚Ä¢ 
                CNPJ da empresa: <span id="footerCNPJ">--</span>
            </p>
        </div>
    </div>
    
    <!-- SISTEMA ADMINISTRATIVO (EMPRESA) -->
    <div class="main-system admin-panel" id="empresaSystem">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo-section">
                <i class="fas fa-building"></i>
                <div>
                    <h1>PontoMaster Admin</h1>
                    <p style="font-size: 0.9rem; color: var(--gray);">Painel Administrativo - Empresa</p>
                </div>
            </div>
            
            <div class="user-info">
                <div class="cloud-status">
                    <i class="fas fa-database"></i>
                    <span id="adminSyncStatus">Conectado</span>
                </div>
                
                <div class="user-badge">
                    <div class="user-avatar" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">E</div>
                    <div>
                        <div id="empresaNome">Empresa</div>
                        <div style="font-size: 0.8rem; color: var(--gray);" id="empresaCNPJDisplay">CNPJ: --</div>
                    </div>
                </div>
                
                <button class="btn" style="padding: 10px 20px; background: rgba(239, 68, 68, 0.2); color: var(--danger);" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>
        
        <!-- Conte√∫do Administrativo -->
        <div style="padding: 30px;">
            <div class="admin-header">
                <h1><i class="fas fa-cog"></i> Painel de Controle da Empresa</h1>
                <p>Gerencie funcion√°rios, relat√≥rios e configura√ß√µes</p>
            </div>
            
            <div class="admin-grid">
                <div class="admin-card" onclick="abrirGerenciarFuncionarios()">
                    <i class="fas fa-users"></i>
                    <h3>Funcion√°rios</h3>
                    <p>Cadastre e gerencie colaboradores</p>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--primary); margin-top: 10px;" id="totalFuncionarios">0</div>
                </div>
                
                <div class="admin-card" onclick="abrirRelatoriosEmpresa()">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Relat√≥rios</h3>
                    <p>Relat√≥rios completos da empresa</p>
                </div>
                
                <div class="admin-card" onclick="abrirControlePonto()">
                    <i class="fas fa-clock"></i>
                    <h3>Controle de Ponto</h3>
                    <p>Monitore registros em tempo real</p>
                </div>
                
                <div class="admin-card" onclick="abrirConfiguracoes()">
                    <i class="fas fa-cogs"></i>
                    <h3>Configura√ß√µes</h3>
                    <p>Personalize seu sistema</p>
                </div>
                
                <div class="admin-card" onclick="gerarCodigoEmpresa()">
                    <i class="fas fa-key"></i>
                    <h3>C√≥digo de Acesso</h3>
                    <p>Gere c√≥digo para novos funcion√°rios</p>
                </div>
                
                <div class="admin-card" onclick="exportarDadosEmpresa()">
                    <i class="fas fa-file-export"></i>
                    <h3>Exportar Dados</h3>
                    <p>Baixe todos os dados da empresa</p>
                </div>
            </div>
            
            <!-- Resumo R√°pido -->
            <div class="card" style="margin-top: 30px;">
                <h2 class="card-title">
                    <i class="fas fa-tachometer-alt"></i> Resumo do Dia
                </h2>
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                    <div>
                        <div style="color: var(--gray); font-size: 0.9rem;">Funcion√°rios Ativos</div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--success);" id="ativosHoje">0</div>
                    </div>
                    
                    <div>
                        <div style="color: var(--gray); font-size: 0.9rem;">Registros Hoje</div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);" id="registrosHoje">0</div>
                    </div>
                    
                    <div>
                        <div style="color: var(--gray); font-size: 0.9rem;">Horas Trabalhadas</div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--warning);" id="horasHoje">0h</div>
                    </div>
                    
                    <div>
                        <div style="color: var(--gray); font-size: 0.9rem;">Atrasos</div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--danger);" id="atrasosHoje">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE VISUALIZA√á√ÉO DE DADOS -->
    <div class="modal" id="dataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: var(--primary);">
                    <i class="fas fa-id-card"></i> Meus Dados Completos
                </h2>
                <button class="modal-close" onclick="closeModal('dataModal')">&times;</button>
            </div>
            
            <div id="modalDataContent">
                <!-- Dados ser√£o carregados aqui -->
            </div>
            
            <div style="margin-top: 30px; display: flex; gap: 15px;">
                <button class="btn btn-primary" onclick="imprimirDados()">
                    <i class="fas fa-print"></i>
                    <span>Imprimir Dados</span>
                </button>
                
                <button class="btn btn-success" onclick="exportarDadosPessoais()">
                    <i class="fas fa-download"></i>
                    <span>Exportar PDF</span>
                </button>
                
                <button class="btn" style="background: rgba(255,255,255,0.1); color: white;" onclick="closeModal('dataModal')">
                    <i class="fas fa-times"></i>
                    <span>Fechar</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE VISUALIZA√á√ÉO DE PDF -->
    <div class="modal" id="pdfModal">
        <div class="modal-content" style="max-width: 90%; height: 90vh;">
            <div class="modal-header">
                <h2 style="color: var(--primary);">
                    <i class="fas fa-file-pdf"></i> Visualiza√ß√£o do Relat√≥rio
                </h2>
                <button class="modal-close" onclick="closeModal('pdfModal')">&times;</button>
            </div>
            
            <div style="width: 100%; height: calc(90vh - 150px);">
                <iframe id="pdfViewer" style="width: 100%; height: 100%; border: none; border-radius: 10px;"></iframe>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="downloadPDF()">
                    <i class="fas fa-download"></i>
                    <span>Baixar PDF</span>
                </button>
                
                <button class="btn btn-success" onclick="printPDF()">
                    <i class="fas fa-print"></i>
                    <span>Imprimir</span>
                </button>
                
                <button class="btn" style="background: rgba(255,255,255,0.1); color: white;" onclick="closeModal('pdfModal')">
                    <i class="fas fa-times"></i>
                    <span>Fechar</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Container de Notifica√ß√µes -->
    <div id="notificationContainer"></div>

    <script>
        // ========== CONFIGURA√á√ÉO DO FIREBASE ==========
        // ‚ö†Ô∏è SUBSTITUA COM SUAS CREDENCIAIS ‚ö†Ô∏è
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJETO_ID",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };
        
        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ========== VARI√ÅVEIS GLOBAIS ==========
        let currentUser = null;
        let userType = null; // 'empresa' ou 'funcionario'
        let userData = null;
        let empresaData = null;
        let funcionarioData = null;
        
        // Vari√°veis do sistema de ponto
        let isWorking = false;
        let isPaused = false;
        let startTime = null;
        let totalSeconds = 0;
        let pontoHistory = [];
        
        // ========== FUN√á√ïES DE FORMATA√á√ÉO ==========
        function formatCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            }
            
            input.value = value;
        }
        
        function formatCPF(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            
            input.value = value;
        }
        
        function formatPIS(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                value = value.replace(/^(\d{3})(\d)/, '$1.$2');
                value = value.replace(/^(\d{3})\.(\d{5})(\d)/, '$1.$2.$3');
                value = value.replace(/(\d{3})\.(\d{5})\.(\d{2})(\d)/, '$1.$2.$3-$4');
            }
            
            input.value = value;
        }
        
        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            
            input.value = value;
        }
        
        // ========== SISTEMA DE AUTENTICA√á√ÉO ==========
        function showAuthTab(tab) {
            // Remove active de todas as abas
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            // Ativa a aba selecionada
            document.getElementById(tab + 'Tab').classList.add('active');
            document.getElementById(tab + 'Form').classList.add('active');
        }
        
        function updateLoginPlaceholder() {
            const tipo = document.getElementById('loginTipo').value;
            const label = document.getElementById('loginLabel');
            const input = document.getElementById('loginIdentificacao');
            
            if (tipo === 'empresa') {
                label.textContent = 'E-mail ou CNPJ';
                input.placeholder = 'E-mail ou CNPJ da empresa';
            } else {
                label.textContent = 'E-mail ou CPF';
                input.placeholder = 'E-mail ou CPF do funcion√°rio';
            }
        }
        
        // Cadastro de Empresa
        async function cadastrarEmpresa() {
            // Valida√ß√µes
            const razaoSocial = document.getElementById('empresaRazaoSocial').value;
            const cnpj = document.getElementById('empresaCNPJ').value.replace(/\D/g, '');
            const email = document.getElementById('empresaEmail').value;
            const senha = document.getElementById('empresaSenha').value;
            const confirmarSenha = document.getElementById('empresaConfirmarSenha').value;
            
            if (!razaoSocial || !cnpj || !email || !senha) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }
            
            if (senha !== confirmarSenha) {
                showNotification('As senhas n√£o coincidem!', 'error');
                return;
            }
            
            if (senha.length < 6) {
                showNotification('A senha deve ter no m√≠nimo 6 caracteres!', 'error');
                return;
            }
            
            if (cnpj.length !== 14) {
                showNotification('CNPJ inv√°lido!', 'error');
                return;
            }
            
            try {
                // Cria usu√°rio no Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, senha);
                
                // Salva dados da empresa no Firestore
                const empresaData = {
                    razaoSocial: razaoSocial,
                    nomeFantasia: document.getElementById('empresaNomeFantasia').value,
                    cnpj: cnpj,
                    ie: document.getElementById('empresaIE').value.replace(/\D/g, ''),
                    email: email,
                    telefone: document.getElementById('empresaTelefone').value,
                    codigoAcesso: generateAccessCode(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    tipo: 'empresa',
                    ativa: true
                };
                
                await db.collection('empresas').doc(userCredential.user.uid).set(empresaData);
                
                showNotification('Empresa cadastrada com sucesso!', 'success');
                
                // Auto login
                await auth.signInWithEmailAndPassword(email, senha);
                
            } catch (error) {
                let message = 'Erro ao cadastrar empresa: ';
                
                switch(error.code) {
                    case 'auth/email-already-in-use':
                        message += 'Este e-mail j√° est√° em uso.';
                        break;
                    case 'auth/invalid-email':
                        message += 'E-mail inv√°lido.';
                        break;
                    case 'auth/weak-password':
                        message += 'Senha muito fraca.';
                        break;
                    default:
                        message += error.message;
                }
                
                showNotification(message, 'error');
            }
        }
        
        // Cadastro de Funcion√°rio
        async function cadastrarFuncionario() {
            // Valida√ß√µes
            const nome = document.getElementById('funcionarioNome').value;
            const cpf = document.getElementById('funcionarioCPF').value.replace(/\D/g, '');
            const email = document.getElementById('funcionarioEmail').value;
            const senha = document.getElementById('funcionarioSenha').value;
            const confirmarSenha = document.getElementById('funcionarioConfirmarSenha').value;
            const codigoEmpresa = document.getElementById('funcionarioCodigoEmpresa').value;
            
            if (!nome || !cpf || !email || !senha || !codigoEmpresa) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }
            
            if (senha !== confirmarSenha) {
                showNotification('As senhas n√£o coincidem!', 'error');
                return;
            }
            
            if (senha.length < 6) {
                showNotification('A senha deve ter no m√≠nimo 6 caracteres!', 'error');
                return;
            }
            
            if (cpf.length !== 11) {
                showNotification('CPF inv√°lido!', 'error');
                return;
            }
            
            // Valida c√≥digo da empresa
            try {
                const empresasSnapshot = await db.collection('empresas')
                    .where('codigoAcesso', '==', codigoEmpresa)
                    .get();
                
                if (empresasSnapshot.empty) {
                    showNotification('C√≥digo da empresa inv√°lido!', 'error');
                    return;
                }
                
                const empresaDoc = empresasSnapshot.docs[0];
                const empresaId = empresaDoc.id;
                const empresaData = empresaDoc.data();
                
                // Cria usu√°rio no Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, senha);
                
                // Salva dados do funcion√°rio no Firestore
                const funcionarioData = {
                    nome: nome,
                    cpf: cpf,
                    pis: document.getElementById('funcionarioPIS').value.replace(/\D/g, ''),
                    dataNascimento: document.getElementById('funcionarioNascimento').value,
                    email: email,
                    empresaId: empresaId,
                    empresaCNPJ: empresaData.cnpj,
                    empresaRazaoSocial: empresaData.razaoSocial,
                    matricula: generateMatricula(),
                    cargo: 'Funcion√°rio',
                    departamento: 'Geral',
                    dataAdmissao: new Date().toISOString().split('T')[0],
                    ativo: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    tipo: 'funcionario'
                };
                
                await db.collection('funcionarios').doc(userCredential.user.uid).set(funcionarioData);
                
                showNotification('Funcion√°rio cadastrado com sucesso!', 'success');
                
                // Auto login
                await auth.signInWithEmailAndPassword(email, senha);
                
            } catch (error) {
                let message = 'Erro ao cadastrar funcion√°rio: ';
                
                switch(error.code) {
                    case 'auth/email-already-in-use':
                        message += 'Este e-mail j√° est√° em uso.';
                        break;
                    default:
                        message += error.message;
                }
                
                showNotification(message, 'error');
            }
        }
        
        // Login no sistema
        async function fazerLogin() {
            const tipo = document.getElementById('loginTipo').value;
            const identificacao = document.getElementById('loginIdentificacao').value;
            const senha = document.getElementById('loginSenha').value;
            
            if (!identificacao || !senha) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            try {
                // Tenta fazer login com e-mail/senha
                await auth.signInWithEmailAndPassword(identificacao, senha);
                
            } catch (error) {
                // Se falhar, pode ser que esteja usando CNPJ/CPF
                try {
                    // Busca empresa/funcion√°rio pelo CNPJ/CPF
                    let query;
                    
                    if (tipo === 'empresa') {
                        query = await db.collection('empresas')
                            .where('cnpj', '==', identificacao.replace(/\D/g, ''))
                            .get();
                    } else {
                        query = await db.collection('funcionarios')
                            .where('cpf', '==', identificacao.replace(/\D/g, ''))
                            .get();
                    }
                    
                    if (query.empty) {
                        throw new Error('Usu√°rio n√£o encontrado!');
                    }
                    
                    const userDoc = query.docs[0];
                    const userData = userDoc.data();
                    
                    // Faz login com o e-mail encontrado
                    await auth.signInWithEmailAndPassword(userData.email, senha);
                    
                } catch (innerError) {
                    showNotification('Credenciais inv√°lidas!', 'error');
                }
            }
        }
        
        // Logout
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                auth.signOut();
                showNotification('Logout realizado!', 'success');
            }
        }
        
        // ========== SISTEMA DE PONTO ==========
        async function startWork() {
            if (!isWorking) {
                isWorking = true;
                startTime = new Date();
                
                // Atualiza UI
                updateStatus('active');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('pauseBtn').disabled = false;
                document.getElementById('endBtn').disabled = false;
                
                // Salva na nuvem
                const registro = {
                    userId: currentUser.uid,
                    tipo: 'inicio',
                    timestamp: new Date().toISOString(),
                    hora: new Date().toLocaleTimeString(),
                    data: new Date().toLocaleDateString(),
                    funcionarioNome: funcionarioData.nome,
                    funcionarioCPF: funcionarioData.cpf,
                    empresaId: funcionarioData.empresaId,
                    empresaCNPJ: funcionarioData.empresaCNPJ,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    await db.collection('registros_ponto').add(registro);
                    await updateSyncStatus();
                    showNotification('Jornada iniciada! Registrado na nuvem.', 'success');
                } catch (error) {
                    showNotification('Erro ao salvar na nuvem: ' + error.message, 'error');
                }
                
                // Inicia timer
                updateWorkTimer();
            }
        }
        
        async function pauseWork() {
            if (isWorking) {
                if (!isPaused) {
                    isPaused = true;
                    updateStatus('paused');
                    
                    // Registra pausa
                    const registro = {
                        userId: currentUser.uid,
                        tipo: 'pausa',
                        timestamp: new Date().toISOString(),
                        hora: new Date().toLocaleTimeString(),
                        data: new Date().toLocaleDateString(),
                        funcionarioNome: funcionarioData.nome,
                        funcionarioCPF: funcionarioData.cpf,
                        empresaId: funcionarioData.empresaId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    try {
                        await db.collection('registros_ponto').add(registro);
                        showNotification('Pausa registrada!', 'warning');
                    } catch (error) {
                        showNotification('Erro ao salvar na nuvem', 'error');
                    }
                    
                } else {
                    isPaused = false;
                    updateStatus('active');
                    
                    // Registra retorno
                    const registro = {
                        userId: currentUser.uid,
                        tipo: 'retorno',
                        timestamp: new Date().toISOString(),
                        hora: new Date().toLocaleTimeString(),
                        data: new Date().toLocaleDateString(),
                        funcionarioNome: funcionarioData.nome,
                        funcionarioCPF: funcionarioData.cpf,
                        empresaId: funcionarioData.empresaId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    try {
                        await db.collection('registros_ponto').add(registro);
                        showNotification('Retorno do almo√ßo!', 'success');
                    } catch (error) {
                        showNotification('Erro ao salvar na nuvem', 'error');
                    }
                }
            }
        }
        
        async function endWork() {
            if (isWorking) {
                isWorking = false;
                isPaused = false;
                
                // Calcula horas
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                
                // Atualiza UI
                updateStatus('inactive');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('endBtn').disabled = true;
                
                // Registra t√©rmino
                const registro = {
                    userId: currentUser.uid,
                    tipo: 'termino',
                    horas: hours,
                    minutos: minutes,
                    totalSegundos: totalSeconds,
                    timestamp: new Date().toISOString(),
                    hora: new Date().toLocaleTimeString(),
                    data: new Date().toLocaleDateString(),
                    funcionarioNome: funcionarioData.nome,
                    funcionarioCPF: funcionarioData.cpf,
                    empresaId: funcionarioData.empresaId,
                    empresaCNPJ: funcionarioData.empresaCNPJ,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    await db.collection('registros_ponto').add(registro);
                    await updateSyncStatus();
                    showNotification(`Jornada encerrada! Total: ${hours}h${minutes}m`, 'success');
                } catch (error) {
                    showNotification('Erro ao salvar na nuvem', 'error');
                }
                
                totalSeconds = 0;
                document.getElementById('workTimer').textContent = '00:00:00';
                
                // Atualiza estat√≠sticas
                updateStats();
            }
        }
        
        function updateStatus(status) {
            const badge = document.getElementById('statusBadge');
            
            switch(status) {
                case 'active':
                    badge.className = 'status-badge active';
                    badge.innerHTML = '<i class="fas fa-play-circle"></i> Trabalhando';
                    break;
                case 'paused':
                    badge.className = 'status-badge paused';
                    badge.innerHTML = '<i class="fas fa-pause-circle"></i> Em pausa';
                    break;
                case 'inactive':
                    badge.className = 'status-badge';
                    badge.innerHTML = '<i class="fas fa-power-off"></i> Fora do expediente';
                    break;
            }
        }
        
        function updateWorkTimer() {
            if (isWorking && !isPaused && startTime) {
                const currentTime = new Date();
                const diff = Math.floor((currentTime - startTime) / 1000);
                totalSeconds = diff;
                
                const hours = Math.floor(diff / 3600);
                const minutes = Math.floor((diff % 3600) / 60);
                const seconds = diff % 60;
                
                const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('workTimer').textContent = timeStr;
                document.getElementById('hoursToday').textContent = `${hours}:${minutes.toString().padStart(2, '0')}`;
            }
            
            setTimeout(updateWorkTimer, 1000);
        }
        
        // ========== SISTEMA DE NUVEM ==========
        async function updateSyncStatus() {
            if (!currentUser) return;
            
            try {
                const now = new Date();
                document.getElementById('lastSyncTime').textContent = `Sincronizado: ${now.toLocaleTimeString()}`;
                
                // Atualiza contador de registros
                const snapshot = await db.collection('registros_ponto')
                    .where('userId', '==', currentUser.uid)
                    .where('data', '==', new Date().toLocaleDateString())
                    .get();
                
                document.getElementById('syncStatus').textContent = `${snapshot.size} registros hoje`;
                
            } catch (error) {
                document.getElementById('syncStatus').innerHTML = '<i class="fas fa-cloud-off"></i> Offline';
                document.getElementById('syncStatus').style.background = 'rgba(239, 68, 68, 0.2)';
                document.getElementById('syncStatus').style.color = 'var(--danger)';
            }
        }
        
        async function syncNow() {
            showNotification('Sincronizando com a nuvem...', 'warning');
            await loadPontoHistory();
            await updateSyncStatus();
            showNotification('Dados sincronizados!', 'success');
        }
        
        async function loadPontoHistory() {
            if (!currentUser || userType !== 'funcionario') return;
            
            try {
                const snapshot = await db.collection('registros_ponto')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();
                
                pontoHistory = [];
                snapshot.forEach(doc => {
                    pontoHistory.push(doc.data());
                });
                
                updateHistoryDisplay();
                
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
        }
        
        function updateHistoryDisplay() {
            const container = document.getElementById('historyContainer');
            container.innerHTML = '';
            
            // Filtra apenas hoje
            const today = new Date().toLocaleDateString();
            const todayHistory = pontoHistory.filter(entry => entry.data === today);
            
            if (todayHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray);">
                        <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Nenhum registro hoje</p>
                    </div>
                `;
                return;
            }
            
            todayHistory.forEach(entry => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let icon = 'fa-clock';
                let color = 'var(--primary)';
                let text = entry.tipo;
                
                switch(entry.tipo) {
                    case 'inicio':
                        icon = 'fa-play-circle';
                        color = 'var(--success)';
                        text = 'In√≠cio da jornada';
                        break;
                    case 'pausa':
                        icon = 'fa-pause-circle';
                        color = 'var(--warning)';
                        text = 'Pausa/Intervalo';
                        break;
                    case 'retorno':
                        icon = 'fa-play-circle';
                        color = 'var(--success)';
                        text = 'Retorno do intervalo';
                        break;
                    case 'termino':
                        icon = 'fa-stop-circle';
                        color = 'var(--danger)';
                        text = `Fim da jornada (${entry.horas}h${entry.minutos}m)`;
                        break;
                }
                
                item.innerHTML = `
                    <div>
                        <div style="font-weight: bold; color: var(--primary);">${entry.hora}</div>
                        <div style="color: var(--gray); font-size: 0.9rem;">${text}</div>
                    </div>
                    <div>
                        <i class="fas ${icon}" style="color: ${color}; font-size: 1.5rem;"></i>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // ========== SISTEMA DE PDF ==========
        function gerarPDFDiario() {
            generatePDF('diario');
        }
        
        function gerarPDFSemanal() {
            generatePDF('semanal');
        }
        
        function gerarPDFMensal() {
            generatePDF('mensal');
        }
        
        function gerarPDFCompleto() {
            generatePDF('completo');
        }
        
        function generatePDF(tipo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabe√ßalho
            doc.setFontSize(20);
            doc.setTextColor(37, 99, 235);
            doc.text("COMPROVANTE DE PONTO", 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Tipo: ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`, 105, 30, { align: 'center' });
            doc.text(`Gerado em: ${new Date().toLocaleString()}`, 105, 36, { align: 'center' });
            
            // Linha divis√≥ria
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 45, 190, 45);
            
            let yPos = 55;
            
            // Dados do Funcion√°rio
            doc.setFontSize(14);
            doc.setTextColor(37, 99, 235);
            doc.text("DADOS DO FUNCION√ÅRIO", 20, yPos);
            yPos += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const dadosFuncionario = [
                ["Nome:", funcionarioData.nome],
                ["CPF:", formatarCPF(funcionarioData.cpf)],
                ["PIS:", funcionarioData.pis ? formatarPIS(funcionarioData.pis) : "N√£o informado"],
                ["Matr√≠cula:", funcionarioData.matricula],
                ["Cargo:", funcionarioData.cargo],
                ["Departamento:", funcionarioData.departamento],
                ["Data Admiss√£o:", funcionarioData.dataAdmissao]
            ];
            
            dadosFuncionario.forEach(([label, value]) => {
                doc.text(`${label} ${value}`, 20, yPos);
                yPos += 7;
            });
            
            yPos += 5;
            
            // Dados da Empresa
            doc.setFontSize(14);
            doc.setTextColor(37, 99, 235);
            doc.text("DADOS DA EMPRESA", 20, yPos);
            yPos += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const dadosEmpresa = [
                ["Raz√£o Social:", empresaData.razaoSocial],
                ["CNPJ:", formatarCNPJ(empresaData.cnpj)],
                ["C√≥digo Empresa:", empresaData.codigoAcesso]
            ];
            
            dadosEmpresa.forEach(([label, value]) => {
                doc.text(`${label} ${value}`, 20, yPos);
                yPos += 7;
            });
            
            yPos += 10;
            
            // Registros de Ponto
            doc.setFontSize(14);
            doc.setTextColor(37, 99, 235);
            doc.text("REGISTROS DE PONTO", 20, yPos);
            yPos += 10;
            
            // Filtra registros baseado no tipo
            let registrosFiltrados = [];
            const hoje = new Date();
            
            switch(tipo) {
                case 'diario':
                    registrosFiltrados = pontoHistory.filter(r => r.data === hoje.toLocaleDateString());
                    break;
                case 'semanal':
                    const semanaAtras = new Date(hoje.setDate(hoje.getDate() - 7));
                    registrosFiltrados = pontoHistory.filter(r => new Date(r.timestamp) >= semanaAtras);
                    break;
                case 'mensal':
                    registrosFiltrados = pontoHistory.filter(r => {
                        const dataReg = new Date(r.timestamp);
                        return dataReg.getMonth() === hoje.getMonth() && 
                               dataReg.getFullYear() === hoje.getFullYear();
                    });
                    break;
                case 'completo':
                    registrosFiltrados = pontoHistory;
                    break;
            }
            
            if (registrosFiltrados.length > 0) {
                const tableData = registrosFiltrados.map(reg => [
                    reg.data,
                    reg.hora,
                    reg.tipo === 'inicio' ? 'Entrada' : 
                    reg.tipo === 'pausa' ? 'Sa√≠da Intervalo' :
                    reg.tipo === 'retorno' ? 'Retorno Intervalo' :
                    reg.tipo === 'termino' ? `Sa√≠da (${reg.horas}h${reg.minutos}m)` : reg.tipo
                ]);
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Data', 'Hora', 'Tipo']],
                    body: tableData,
                    margin: { left: 20, right: 20 },
                    styles: { fontSize: 10 },
                    headStyles: { fillColor: [37, 99, 235], textColor: [255, 255, 255] }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
            } else {
                doc.setFontSize(11);
                doc.text("Nenhum registro encontrado para o per√≠odo selecionado.", 20, yPos);
                yPos += 10;
            }
            
            // Assinatura
            doc.setFontSize(10);
            doc.setTextColor(150, 150, 150);
            doc.text("Documento gerado eletronicamente pelo sistema PontoMaster", 105, doc.internal.pageSize.height - 20, { align: 'center' });
            doc.text("Este documento possui validade jur√≠dica conforme Lei n¬∫ 13.467/2017", 105, doc.internal.pageSize.height - 15, { align: 'center' });
            
            // Salva PDF
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            
            // Atualiza visualizador
            document.getElementById('pdfViewer').src = pdfUrl;
            
            // Salva refer√™ncia para download
            window.currentPDFBlob = pdfBlob;
            window.currentPDFUrl = pdfUrl;
            
            // Abre modal
            openModal('pdfModal');
            
            showNotification('PDF gerado com sucesso!', 'success');
        }
        
        function visualizarPDF() {
            if (!window.currentPDFUrl) {
                showNotification('Gere um PDF primeiro!', 'warning');
                return;
            }
            openModal('pdfModal');
        }
        
        function baixarPDF() {
            if (!window.currentPDFBlob) {
                showNotification('Gere um PDF primeiro!', 'warning');
                return;
            }
            
            const link = document.createElement('a');
            link.href = window.currentPDFUrl;
            link.download = `comprovante-ponto-${new Date().getTime()}.pdf`;
            link.click();
            
            showNotification('PDF baixado com sucesso!', 'success');
        }
        
        function imprimirPDF() {
            if (!window.currentPDFUrl) return;
            
            const iframe = document.getElementById('pdfViewer');
            iframe.contentWindow.print();
        }
        
        // ========== FUN√á√ïES AUXILIARES ==========
        function generateAccessCode() {
            return 'EMP' + Math.random().toString(36).substr(2, 8).toUpperCase();
        }
        
        function generateMatricula() {
            return 'FUNC' + Math.random().toString().substr(2, 6);
        }
        
        function formatarCPF(cpf) {
            if (!cpf) return '';
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }
        
        function formatarCNPJ(cnpj) {
            if (!cnpj) return '';
            return cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
        }
        
        function formatarPIS(pis) {
            if (!pis) return '';
            return pis.replace(/(\d{3})(\d{5})(\d{2})(\d{1})/, '$1.$2.$3-$4');
        }
        
        function visualizarMeusDados() {
            const content = document.getElementById('modalDataContent');
            content.innerHTML = `
                <div style="display: grid; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">Nome Completo:</div>
                        <div style="font-weight: 500;">${funcionarioData.nome}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">CPF:</div>
                        <div style="font-weight: 500;">${formatarCPF(funcionarioData.cpf)}</div>
                    </div>
                    
                    ${funcionarioData.pis ? `
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">PIS/PASEP:</div>
                        <div style="font-weight: 500;">${formatarPIS(funcionarioData.pis)}</div>
                    </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">Matr√≠cula:</div>
                        <div style="font-weight: 500;">${funcionarioData.matricula}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">Cargo:</div>
                        <div style="font-weight: 500;">${funcionarioData.cargo}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">Departamento:</div>
                        <div style="font-weight: 500;">${funcionarioData.departamento}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">Data de Admiss√£o:</div>
                        <div style="font-weight: 500;">${funcionarioData.dataAdmissao}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">Empresa:</div>
                        <div style="font-weight: 500;">${empresaData.razaoSocial}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">CNPJ da Empresa:</div>
                        <div style="font-weight: 500;">${formatarCNPJ(empresaData.cnpj)}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--gray);">C√≥digo da Empresa:</div>
                        <div style="font-weight: 500;">${empresaData.codigoAcesso}</div>
                    </div>
                </div>
            `;
            
            openModal('dataModal');
        }
        
        function exportarDadosPessoais() {
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.setTextColor(37, 99, 235);
            doc.text("DADOS PESSOAIS DO FUNCION√ÅRIO", 105, 20, { align: 'center' });
            
            let yPos = 40;
            const dados = [
                ["Nome:", funcionarioData.nome],
                ["CPF:", formatarCPF(funcionarioData.cpf)],
                ["PIS:", funcionarioData.pis ? formatarPIS(funcionarioData.pis) : "N√£o informado"],
                ["Matr√≠cula:", funcionarioData.matricula],
                ["Cargo:", funcionarioData.cargo],
                ["Departamento:", funcionarioData.departamento],
                ["Data Admiss√£o:", funcionarioData.dataAdmissao],
                ["Empresa:", empresaData.razaoSocial],
                ["CNPJ Empresa:", formatarCNPJ(empresaData.cnpj)],
                ["Data do Documento:", new Date().toLocaleDateString()]
            ];
            
            dados.forEach(([label, value]) => {
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text(`${label} ${value}`, 20, yPos);
                yPos += 10;
            });
            
            doc.save(`dados-pessoais-${funcionarioData.cpf}.pdf`);
            showNotification('Dados exportados para PDF!', 'success');
        }
        
        function updateStats() {
            // Calcula estat√≠sticas do m√™s
            const hoje = new Date();
            const registrosMes = pontoHistory.filter(r => {
                const dataReg = new Date(r.timestamp);
                return dataReg.getMonth() === hoje.getMonth() && 
                       dataReg.getFullYear() === hoje.getFullYear();
            });
            
            const horasMes = registrosMes
                .filter(r => r.tipo === 'termino')
                .reduce((total, r) => total + (r.horas || 0) + (r.minutos || 0)/60, 0);
            
            const diasTrabalhados = [...new Set(registrosMes.filter(r => r.tipo === 'inicio').map(r => r.data))].length;
            
            document.getElementById('statsHours').textContent = horasMes.toFixed(1) + 'h';
            document.getElementById('statsDays').textContent = diasTrabalhados;
            document.getElementById('statsAvg').textContent = (diasTrabalhados > 0 ? (horasMes/diasTrabalhados).toFixed(1) : 0) + 'h';
            document.getElementById('statsEfficiency').textContent = Math.min(100, Math.floor((horasMes/(diasTrabalhados * 8)) * 100)) + '%';
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i>
                ${message}
            `;
            
            document.getElementById('notificationContainer').appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        // ========== OBSERVADOR DE AUTENTICA√á√ÉO ==========
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                
                try {
                    // Tenta buscar como empresa
                    const empresaDoc = await db.collection('empresas').doc(user.uid).get();
                    
                    if (empresaDoc.exists) {
                        userType = 'empresa';
                        empresaData = empresaDoc.data();
                        
                        // Configura sistema da empresa
                        setupEmpresaSystem();
                        
                    } else {
                        // Tenta buscar como funcion√°rio
                        const funcionarioDoc = await db.collection('funcionarios').doc(user.uid).get();
                        
                        if (funcionarioDoc.exists) {
                            userType = 'funcionario';
                            funcionarioData = funcionarioDoc.data();
                            
                            // Busca dados da empresa
                            const empresaRef = await db.collection('empresas').doc(funcionarioData.empresaId).get();
                            empresaData = empresaRef.data();
                            
                            // Configura sistema do funcion√°rio
                            setupFuncionarioSystem();
                            
                        } else {
                            throw new Error('Usu√°rio n√£o encontrado em nenhuma base');
                        }
                    }
                    
                    // Esconde tela de auth, mostra sistema
                    document.getElementById('authContainer').style.display = 'none';
                    
                } catch (error) {
                    showNotification('Erro ao carregar dados do usu√°rio: ' + error.message, 'error');
                    auth.signOut();
                }
                
            } else {
                // Usu√°rio n√£o logado
                currentUser = null;
                userType = null;
                document.getElementById('authContainer').style.display = 'flex';
                document.getElementById('funcionarioSystem').style.display = 'none';
                document.getElementById('empresaSystem').style.display = 'none';
            }
        });
        
        function setupFuncionarioSystem() {
            // Atualiza interface
            document.getElementById('userName').textContent = funcionarioData.nome;
            document.getElementById('userMatricula').textContent = `Matr√≠cula: ${funcionarioData.matricula}`;
            document.getElementById('userAvatar').textContent = funcionarioData.nome.charAt(0).toUpperCase();
            document.getElementById('employeePhoto').textContent = funcionarioData.nome.charAt(0).toUpperCase();
            document.getElementById('footerCNPJ').textContent = formatarCNPJ(empresaData.cnpj);
            
            // Atualiza detalhes do funcion√°rio
            const details = document.getElementById('employeeDetails');
            details.innerHTML = `
                <div><span>CPF:</span><span>${formatarCPF(funcionarioData.cpf)}</span></div>
                <div><span>Matr√≠cula:</span><span>${funcionarioData.matricula}</span></div>
                <div><span>Cargo:</span><span>${funcionarioData.cargo}</span></div>
                <div><span>Empresa:</span><span>${empresaData.razaoSocial}</span></div>
            `;
            
            // Carrega dados
            loadPontoHistory();
            updateStats();
            updateSyncStatus();
            
            // Mostra sistema
            document.getElementById('funcionarioSystem').style.display = 'block';
        }
        
        function setupEmpresaSystem() {
            // Atualiza interface
            document.getElementById('empresaNome').textContent = empresaData.razaoSocial;
            document.getElementById('empresaCNPJDisplay').textContent = `CNPJ: ${formatarCNPJ(empresaData.cnpj)}`;
            
            // Carrega estat√≠sticas da empresa
            loadEmpresaStats();
            
            // Mostra sistema
            document.getElementById('empresaSystem').style.display = 'block';
        }
        
        async function loadEmpresaStats() {
            try {
                // Conta funcion√°rios
                const funcionariosSnapshot = await db.collection('funcionarios')
                    .where('empresaId', '==', currentUser.uid)
                    .get();
                
                document.getElementById('totalFuncionarios').textContent = funcionariosSnapshot.size;
                
                // Registros de hoje
                const hoje = new Date().toLocaleDateString();
                const registrosSnapshot = await db.collection('registros_ponto')
                    .where('empresaId', '==', currentUser.uid)
                    .where('data', '==', hoje)
                    .get();
                
                document.getElementById('registrosHoje').textContent = registrosSnapshot.size;
                
                // Funcion√°rios ativos hoje
                const funcionariosAtivos = new Set(registrosSnapshot.docs.map(doc => doc.data().userId));
                document.getElementById('ativosHoje').textContent = funcionariosAtivos.size;
                
            } catch (error) {
                console.error('Erro ao carregar stats da empresa:', error);
            }
        }
        
        // ========== FUN√á√ïES DO PAINEL ADMIN ==========
        function abrirGerenciarFuncionarios() {
            showNotification('Abrindo gerenciamento de funcion√°rios...', 'success');
            // Implementar modal de gest√£o de funcion√°rios
        }
        
        function abrirRelatoriosEmpresa() {
            showNotification('Abrindo relat√≥rios da empresa...', 'success');
            // Implementar relat√≥rios empresariais
        }
        
        function abrirControlePonto() {
            showNotification('Abrindo controle de ponto...', 'success');
            // Implementar monitoramento em tempo real
        }
        
        function abrirConfiguracoes() {
            showNotification('Abrindo configura√ß√µes...', 'success');
            // Implementar configura√ß√µes da empresa
        }
        
        function gerarCodigoEmpresa() {
            alert(`C√≥digo da Empresa: ${empresaData.codigoAcesso}\n\nCompartilhe este c√≥digo com seus funcion√°rios para que eles possam se cadastrar.`);
        }
        
        function exportarDadosEmpresa() {
            showNotification('Exportando dados da empresa...', 'success');
            // Implementar exporta√ß√£o completa
        }
        
        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Inicia timer de trabalho
            updateWorkTimer();
            
            // Atualiza status de sync periodicamente
            setInterval(async () => {
                if (currentUser && userType === 'funcionario') {
                    await updateSyncStatus();
                }
            }, 30000);
        });
    </script>
</body>
</html>